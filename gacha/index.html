HTML_TEMPLATE_SLOT = """
<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <title>ã‚¹ãƒ­ãƒƒãƒˆå‹ ãŠå°é£ã„ã‚¬ãƒãƒ£</title>
    <style>
        /* CSS */
        body {
            font-family: sans-serif;
            text-align: center;
            padding: 50px;
            background-color: #333; /* èƒŒæ™¯ã‚’æš—ã */
            color: white;
        }
        .container {
            background-color: #222;
            padding: 40px;
            border-radius: 15px;
            box-shadow: 0 10px 20px rgba(0,0,0,0.5);
            max-width: 600px;
            margin: 0 auto;
        }
        h1 {
            color: #ffcc00; /* ã‚´ãƒ¼ãƒ«ãƒ‰ç³»ã®è‰² */
            margin-bottom: 30px;
        }
        
        /* ã‚¹ãƒ­ãƒƒãƒˆã®ã‚³ãƒ³ãƒ†ãƒŠ */
        .slot-display {
            display: flex;
            justify-content: center;
            margin: 30px 0;
            perspective: 500px; /* 3Då›è»¢ã®ãŸã‚ã®é è¿‘æ„Ÿ */
        }
        
        /* å„æ¡ã®è¦‹ãŸç›® */
        .digit {
            width: 80px;
            height: 120px;
            margin: 0 10px;
            overflow: hidden; /* æ•°å­—ã®å›è»¢ã‚’éš ã™ */
            border: 5px solid #ffcc00;
            border-radius: 10px;
            background-color: #000;
            box-shadow: inset 0 0 10px rgba(255, 255, 255, 0.5);
            line-height: 120px; /* å‚ç›´æ–¹å‘ã®ä¸­å¤®æƒãˆ */
            font-size: 4em;
            color: #00ff00; /* ãƒã‚ªãƒ³ã‚°ãƒªãƒ¼ãƒ³ */
            font-weight: bold;
            position: relative;
        }
        
        /* å›è»¢ã™ã‚‹æ•°å­—ã®ãƒªã‚¹ãƒˆ */
        .numbers {
            position: absolute;
            top: 0;
            width: 100%;
            transition: transform 0.1s; /* æ»‘ã‚‰ã‹ãªå›è»¢ã®ãŸã‚ã®ãƒˆãƒ©ãƒ³ã‚¸ã‚·ãƒ§ãƒ³ */
        }
        
        .numbers.spinning {
            /* ã‚¹ãƒ­ãƒƒãƒˆå›è»¢ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ç”¨ã®ã‚¹ã‚¿ã‚¤ãƒ«ã¯JavaScriptã§æ“ä½œ */
        }

        .gacha-button {
            background-color: #ff5722; /* ã‚ªãƒ¬ãƒ³ã‚¸ */
            color: white;
            padding: 15px 40px;
            font-size: 1.4em;
            border: none;
            border-radius: 50px;
            cursor: pointer;
            margin-top: 30px;
            transition: background-color 0.3s, transform 0.1s;
        }
        .gacha-button:hover {
            background-color: #e64a19; 
            transform: scale(1.05);
        }
        .gacha-button:disabled {
            background-color: #777;
            cursor: not-allowed;
        }
        .result-text {
            margin-top: 20px;
            font-size: 1.2em;
            color: #ddd;
        }
        .yen {
            font-size: 0.5em;
            color: #ffcc00;
            font-weight: normal;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ° ã‚¹ãƒ­ãƒƒãƒˆã§ãŠå°é£ã„ã‚²ãƒƒãƒˆï¼ ğŸ°</h1>
        
        <p>ãƒœã‚¿ãƒ³ã‚’æŠ¼ã—ã¦ã€ä»Šæ—¥ã®ãŠå°é£ã„ï¼ˆ10å††ï½100å††ï¼‰ã‚’æ±ºã‚ã‚ˆã†ï¼</p>
        
        <div class="slot-display">
            <div class="digit" id="digit3"><div class="numbers">0</div></div>
            <div class="digit" id="digit2"><div class="numbers">0</div></div>
            <div class="digit" id="digit1"><div class="numbers">0</div></div>
            <div class="digit" style="border:none; background:none; box-shadow:none; width:50px; font-size:1.5em; line-height:120px; color:#ffcc00;">
                <span class="yen">å††</span>
            </div>
        </div>
        
        <button class="gacha-button" id="gachaButton">START!</button>
        
        <p class="result-text" id="message">çµæœå¾…ã¡...</p>
    </div>

    <script>
        // JavaScript
        const button = document.getElementById('gachaButton');
        const message = document.getElementById('message');
        const digits = [
            { element: document.querySelector('#digit1 .numbers'), finalValue: 0, pool: [0] }, // 1ã®ä½ã¯å¸¸ã« 0
            { element: document.querySelector('#digit2 .numbers'), finalValue: 0, pool: [0, 1, 2, 3, 4, 5, 6, 7, 8, 9] }, // 10ã®ä½
            { element: document.querySelector('#digit3 .numbers'), finalValue: 0, pool: [0, 1] } // 100ã®ä½ã¯ 0 or 1
        ];
        const SPIN_DURATION = 3000; // 3ç§’é–“ã‚¹ãƒ­ãƒƒãƒˆã‚’å›è»¢ã•ã›ã‚‹

        // æ•°å­—ãƒªã‚¹ãƒˆã‚’ç”Ÿæˆã™ã‚‹ãƒ˜ãƒ«ãƒ‘ãƒ¼é–¢æ•°
        function createNumberStrip(pool) {
            let html = '';
            // å›è»¢ä¸­ã«å¤šæ§˜ãªæ•°å­—ã‚’è¦‹ã›ã‚‹ãŸã‚ã€ãƒ—ãƒ¼ãƒ«ã‚’è¤‡æ•°å›é€£çµã™ã‚‹
            for (let j = 0; j < 5; j++) {
                for (const num of pool) {
                    html += `<div>${num}</div>`;
                }
            }
            return html;
        }

        // åˆæœŸåŒ–: å„ã‚¹ãƒ­ãƒƒãƒˆã«å›è»¢ç”¨ã®æ•°å­—ã®ã‚¹ãƒˆãƒªãƒƒãƒ—ã‚’ã‚»ãƒƒãƒˆ
        digits.forEach(d => {
            d.element.innerHTML = createNumberStrip(d.pool);
            // åˆæœŸè¡¨ç¤ºã‚’ä¸­å¤®ã® 0 ã«åˆã‚ã›ã‚‹
            d.element.style.transform = 'translateY(0px)';
        });

        // ãƒœã‚¿ãƒ³ã‚¯ãƒªãƒƒã‚¯æ™‚ã®å‡¦ç†
        button.addEventListener('click', async () => {
            // å›è»¢ä¸­ã¯ãƒœã‚¿ãƒ³ã‚’ç„¡åŠ¹åŒ–
            button.disabled = true;
            message.textContent = "å›è»¢ä¸­...";

            // ã‚µãƒ¼ãƒãƒ¼ã‹ã‚‰çµæœã‚’å–å¾—
            const response = await fetch('/spin', { method: 'POST' });
            const data = await response.json();
            const resultAmount = data.amount; // ä¾‹: 80

            // çµæœã®é‡‘é¡ã‚’å„æ¡ã«åˆ†è§£
            // 80å†† -> [8, 0, 0]
            // 100å†† -> [0, 0, 1]
            const s = String(resultAmount).padStart(3, '0'); // "080" or "100"
            digits[0].finalValue = parseInt(s[2]); // 1ã®ä½ (å¸¸ã«0)
            digits[1].finalValue = parseInt(s[1]); // 10ã®ä½
            digits[2].finalValue = parseInt(s[0]); // 100ã®ä½

            // å›è»¢é–‹å§‹
            digits.forEach((d, index) => {
                // ã‚¹ãƒ­ãƒƒãƒˆã®é«˜ã•
                const digitHeight = d.element.offsetHeight / d.element.children.length; // 1ã¤ã®æ•°å­—ã®é«˜ã•

                // æœ€çµ‚çš„ãªä½ç½®ã‚’è¨ˆç®— (ã‚¹ãƒˆãƒªãƒƒãƒ—ã®æœ€å¾Œã®ãƒ«ãƒ¼ãƒ—ã‹ã‚‰é€†ç®—ã—ã¦å›ºå®š)
                // d.pool.length * 4 (æ•°å­—ã®ãƒ–ãƒ­ãƒƒã‚¯æ•°) + (d.pool.indexOf(d.finalValue) + 1)
                
                // æœ€çµ‚å€¤ã®ä½ç½®ï¼ˆã‚¹ãƒˆãƒªãƒƒãƒ—ã®ä¸€ç•ªæœ€å¾Œã®ãƒ–ãƒ­ãƒƒã‚¯ã®ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ï¼‰
                const finalValueIndex = d.pool.lastIndexOf(d.finalValue);
                // æœ€å¾Œã®ãƒ–ãƒ­ãƒƒã‚¯ã«ç§»å‹•ã•ã›ã‚‹ãŸã‚ã®ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹
                const targetIndex = (d.pool.length * 4) + finalValueIndex;
                
                // æœ€çµ‚çš„ãªYåº§æ¨™ (æœ€å¾Œã®ãƒ–ãƒ­ãƒƒã‚¯ã®æœ€çµ‚å€¤ã®ä½ç½®)
                const finalPosition = -targetIndex * digitHeight; 
                
                // ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³è¨­å®š
                d.element.style.transition = `transform ${SPIN_DURATION / 1000 + index * 0.5}s ease-out`; // æ¡ã”ã¨ã«å°‘ã—é…å»¶
                d.element.style.transform = `translateY(${finalPosition}px)`;
            });

            // ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³çµ‚äº†å¾Œã«å®Ÿè¡Œ
            setTimeout(() => {
                message.textContent = `çµæœ: ${resultAmount}å†† ç²å¾—ï¼ ğŸ‰`;
                button.disabled = false;
            }, SPIN_DURATION + 500); // æœ€å¾Œã®ã‚¹ãƒ­ãƒƒãƒˆã®å›è»¢æ™‚é–“ + ä½™è£•

        });

    </script>
</body>
</html>